# **count-subarrays-with-cost-less-than-or-equal-to-k**
**ğŸ”— é¢˜ç›®é“¾æ¥ï¼š**  
**[count-subarrays-with-cost-less-than-or-equal-to-k](https://leetcode.cn/problems/count-subarrays-with-cost-less-than-or-equal-to-k/)**
---

## **è§£é¢˜ä»£ç ï¼ˆC++ï¼‰**

```cpp
class Solution {
public:
    long long countSubarrays(vector<int>& nums, long long k) {
        int n = nums.size();
        deque<int> maxq, minq;
        long long ans = 0;
        int l = 0;

        for (int r = 0; r < n; r++) {
            while (!maxq.empty() && nums[maxq.back()] <= nums[r])
                maxq.pop_back();
            maxq.push_back(r);

            while (!minq.empty() && nums[minq.back()] >= nums[r])
                minq.pop_back();
            minq.push_back(r);

            while ((long long)(nums[maxq.front()] - nums[minq.front()]) * (r - l + 1) > k) {
                if (maxq.front() == l) maxq.pop_front();
                if (minq.front() == l) minq.pop_front();
                l++;
            }

            ans += (r - l + 1);
        }
        return ans;
    }
};



è§£é¢˜æ€è·¯ï¼š
æ‰€æœ‰å€¼æ¯”nums[r]å°çš„éƒ½è¢«å¼¹å‡ºæ¥äº†ï¼Œç•™ä¸‹æ¥çš„å€¼éƒ½æ¯”nums[r]å¤§ï¼Œå°±ä»é˜Ÿå¤´åˆ°é˜Ÿå°¾é€’å‡çš„é˜Ÿåˆ—ä¸¾ä¾‹çš„è¯ï¼Œåœ¨rå‰é¢å­˜çš„åªèƒ½æ˜¯ä¸‹æ ‡å°äºrå¹¶ä¸”å€¼å¤§äºnums[r]çš„ä¸‹æ ‡ï¼Œ
åˆ°äº†whileå¾ªç¯ä¸­ï¼Œå¦‚æœä¸æ»¡è¶³<=kå°±ä¼šæ¯”è¾ƒæœ€å¤§å…ƒç´ ï¼Œåªè¦å®ƒæ˜¯ç­‰äºleftå°±å¼¹å‡ºï¼Œä½†æ˜¯å°äºleftçš„ä¸‹æ ‡éƒ½å·²ç»è¢«å¼¹å‡ºæ¥äº†ï¼Œè¿™æ˜¯årightéƒ½æ˜¯å›ºå®šå¥½äº†ï¼Œåªè¦ç§»åŠ¨
leftå°±å¯ä»¥äº†ï¼Œå¦‚æœè¿™æ—¶å€™çš„æœ€å¤§å€¼æ°å¥½æ˜¯lçš„ï¼Œå°±ç›´æ¥å¼¹å‡ºå°±å¥½äº†ï¼Œè¿™æ ·åé¢çš„å°±æ˜¯ä¸‹æ ‡å¤§äºlçš„äº†.ç”¨æ»‘åŠ¨çª—å£æ˜¯å› ä¸ºl->rä¹‹é—´å¦‚æœæ‰©å¤§çš„è¯ï¼Œåªä¼šå‡ºç°ä¸æ»¡è¶³çš„
ç»“æœï¼Œå› ä¸ºmaxå’Œminä¼šæ”¹å˜ï¼Œè¿™é‡Œåªè¦å°†rä¸æ–­å·¦ç§»ï¼Œlè·Ÿç€å·¦ç§»å°±å¯ä»¥äº†ï¼Œå› ä¸ºlå¦‚æœå³ç§»åŠ¨åªä¼šå‡ºç°ä¸æ»¡è¶³çš„æƒ…å†µï¼Œå°±æ²¡æœ‰è®¨è®ºçš„å¿…è¦äº†ã€‚
